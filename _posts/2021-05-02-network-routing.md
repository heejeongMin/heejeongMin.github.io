---
layout: post
title: 라우팅
subtitle: 그림으로 배우는 네트워크 원리
categories: infrastructure
tags: [NETWORK, INFRASTRUCTURE]
---

## 라우터

- 이더넷, 무선 랜은 같은 네트워크 안에서 데이터를 전송할 수 있다. **다른 네트워크에 데이터를 보내려면 네트워크를 서로 연결해야 하는데 이때 라우터를 통해 데이터를 전송 할 수 있다**.
- 라우터는 데이터의 목적지가 어느 네트워크에 접속해 있는지 판단하여, 연결된 네트워크의 라우터로 전송하는 라우팅을 수행한다.

![Network_router_connection](/assets/images/network/Network_router_connection.png)


## 데이터 전송

- 전송 대상은 IP 패킷으로 TCP/IP 계층의 인터넷 계층에 속하기 때문에 **라우팅은 인터넷 계층에서 동작하게 된다.**
- IP패킷의 IP 헤더 안의 목적지 주소를 확인한 후, **TTL과 헤더 체크섬만 변경**한다. (NAT 주소 변환이 이루어질때만 IP주소도 변환) 그리고, 네트워크 인터페이스 층의 프로토콜인 이더넷 헤더는 라우터가 전송할 때 완전히 새로운 헤더로 교채된다.
- 라우터에는 복수의 인터페이스가 있어 물리적인 배선과 IP 주소 설정이 필요하다. 라우터 끼리 연결하려면 오른쪽 그림의 네트워크 3 처럼 양쪽의 라우터의 물리적 연결을 갖는 것이 필요하고, 해당 **네트워크를 통해 IP 패킷이 전송된다.**
-직접 접속은 동일 네트워크, 라우팅정보가 기재되어 있는 것은 다른 네트워크로 구분

![Network_routing_data_send](/assets/images/network/Network_routing_data_send.png)


## 라우팅 테이블

- 라우팅 테이블에는 어떤 네트워크로 IP 패킷을 보내야하는지 경로가 등록되어 있다.
- 라우팅 테이블에 등록된 네트워크 정보를 루트 정보/경로 정보라고 부른다.
- 경로 정보에서 중요한 것은 목적지의 네트워크 주소/서브넷 마스크와 넥스트 홉 주소 이다.
- 라우터 테이블로 이웃 라우터의 네트워크 구성을 인식하고 이 구조가 반복되어 최종 목적지까지 도착한다.
- 만드는법
    - **직접접속**
        - 가장 기본적인 경로로 라우터가 직접 연결된 네트워크의 경로이다.
        - 라우터 인터페이스에 IP 설정 후 인터페이스 활성화하면 자동으로 설정한 IP주소에 대응하는 네트워크 주소의 경로가 직접 정보의 경로 정보로 라우팅 테이블에 등록된다.
        ![Network_routing_direct_access](/assets/images/network/Network_routing_direct_access.png)
    
    - **스태틱 라우팅**
        - 라우터에 커맨드를 입력하는 등 경로 정보를 수동으로 라우팅 테이블에 등록하는 방법.
        - 커맨드는 제조사마다 다르지만 네트워크 주소/서브넷 마스크/넥스트 홉 주소를 입력하여 라우팅 테이블에 등록하는 것은 동일하다.
        ![Network_routing_static](/assets/images/network/Network_routing_static.png)
    
    - **라우팅 프로토콜**
        - 라우터 프로토콜이 활성화 되면 라우터끼리 정보를 교환해 라우팅 테이블에 필요한 경로 정보를 등록해 준다.
        - 라우팅 프로토콜 종류
            1. RIP (Routing Information Protocol) :  소규모
            2. OSPF (Open Shortest Path First) : 중~대규모 
            3. BGP (Border Gateway Protocol) : 인터넷 백본 ( AWS 백본도 이걸 사용할까 ?)
        ![Network_routing_protocol](/assets/images/network/Network_routing_protocol.png)

    - **경로 요약**
        - 단, 네트워크가 얼마나 많은데 이걸 다 일일히 등록할 수가 없어 요약해서 등록하는 "경로 요약" 을 사용한다. 넥스트 홉이 동일한 네트워크는 하나로 모아 등록하는 방법이다. —> 어떻게 하나로 모으냐면 .. CIDR범위를 올려준다. 오른쪽 사진 예제 기준.
        - 가장 극단적으로 사용한 예는 디폴트경로를 사용한것인데 0.0.0.0/0 으로 전부 열어두는 것이다. 모두 열어두었기 때문에 들어올수 있고, 대신 넥스트홉 정보는 들고 들어오기 때문에 다음에 어디로 가야할지는 알 수 있다.

            ex ) NW/SW : 0.0.0.0/0  넥스트홉 : 10.2.0.0
            
        ![Network_routing_summary](/assets/images/network/Network_routing_summary.png)



## 레이어3 스위치

- 레이어2 스위치에 라우터 기능을 추가한 네트워크 기기로 레이어2 스위치처럼 데이터 전송을 할 수도 있고, 라우터 처럼 데이터 전송도 할 수도 있다. 레이어3 스위치도 레이어2 스위치와 외관은 매우 비슷하게 생겼다.
    - 레이어2 스위치와 라우터의 데이터 전송 방법이 어떻게 다른가?

    ![Network_router_vs_layer2_switch](/assets/images/network/Network_router_vs_layer2_switch.png)

- 그래서 레이어3 스위치를 사용하면 동일 네트워크면 레이어2 스위치처럼 작동하고, 다른 네트워크로 보내야하면 라우터기능을 사용한다.

## 레이어2 스위치와 VLAN

- 레이어2 스위치는 하나의 이더넷 네트워크를 구성하는 네트워크 기기인데, 하나의 네트워크에 수많은 기기를 연결하면 불필요한 데이터 전송이 많이 발생하게 된다.
- 불필요한 데이터 전송을 억제하고 관리측면을 위해서 네트워크를 분리할 수 있고, 그 분리가 VLAN을 통해서 가능하다.
- VLAN으로 분할하고 할당하고 싶은 포트를 넣어서 자유롭게 분할할 수 있다.
- 단 처음에 나누었을때 VLAN 끼리는 스위치로는 연결되어 있지 않은 상태이다. 서로 통신하기 위해서 라우터와 레이어 3 스위치가 필요로 하게 된다. 둘중 하나를 사용할 수 있는데 어쨋것 VLAN끼리 연결하는 것을 VLAN간 라우팅이라고 부른다.
    - 라우터 보다는 레이어3 스위치를 이요하는 것이 더 효율적으로 연결할 수 있다. 이렇게 하려면 라우터 3 스위치에 IP 주소를 설정해주는데 2가지 방법이 존재한다.
        1. 레이어 3 스위치 내보의 가상 인터페이스에 IP주소를 설정한다.
        2. 레이어 3 스위치의 포트 자체에 IP 주소를 설정하낟. 
- VLAN은 1개의 스위치의 그룹화하여 나눌 수도 있지만, N개의 스위치에 대해서도 가능하며, 이때 스위치사이를 연결하기 위해 태그 VLAN (트렁크) 가 필요하다.
    - 트렁크로 연결되는 경우 이더넷 프레임에 VLAN 태그가 더 생기고, 이 것을 이용해서 어느 VLAN으로 연결해야하는지 알 수 있다.
 
![Network_layer2_switch_vlan_1](/assets/images/network/Network_layer2_switch_vlan_1.png)
![Network_layer2_switch_vlan_2](/assets/images/network/Network_layer2_switch_vlan_2.png)
